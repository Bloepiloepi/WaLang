class Client{constructor({prefix:e="!",self_commands:t=!0,queue:r=!1,queue_max_length:n=5,fetchInterval:a=100,autosaveInterval:s=1e4}={prefix:"!",self_commands:!0,queue:!1,queue_max_length:5,fetchInterval:100,autosaveInterval:1e4}){this.commands=new Map,this.events={},this.handledMessages=null===localStorage.getItem("handledMessages")?new Array:Array.from(JSON.parse(localStorage.getItem("handledMessages"))),setInterval(()=>{if(null!==getChat()){const a=r?[].slice.call(getChat().children,-n):[getChat().lastChild];for(const r of a)if(r.hasAttribute("data-id")&&!this.handledMessages.includes(r.getAttribute("data-id"))){this.handledMessages.push(r.getAttribute("data-id"));const n=this.getMessageFromElement(r);if(void 0!==n){if(t||r.getAttribute("data-id").startsWith("false_"))for(const[t,r]of this.commands.entries())if(n.content.message.startsWith(e+t))return r(n,n.content.message.substring(e.length+t.length).split(" ").splice(1)),void this.emit("command",[t,r]);this.emit("message",n),this.emit("message_"+(r.getAttribute("data-id").startsWith("true_")?"self":"other"),n)}}}},a),setInterval(()=>{localStorage.setItem("handledMessages",JSON.stringify(null===localStorage.getItem("handledMessages")?new Array:Array.from(JSON.parse(localStorage.getItem("handledMessages"))).slice(-10*n)))},s),this.emit("init")}registerCommand(e,t){this.commands.set(e,t)}unregisterCommand(e){this.commands.delete(e)}emit(e,...t){for(let r of this.events[e]||[])r(...t)}on(e,t){return(this.events[e]=this.events[e]||[]).push(t),()=>this.events[e]=this.events[e].filter(e=>e!==t)}sendMessage(e){const t=getTextBox().textContent;getTextBox().textContent=e,getTextBox().dispatchEvent(new InputEvent("input",{bubbles:!0})),new Promise(e=>{null!==getSendButton()&&(getSendButton().click(),getTextBox().textContent=t,getTextBox().dispatchEvent(new InputEvent("input",{bubbles:!0})),e())})}gotoNewestChat(){for(const e of getChats().children)"translateY(0px)"===e.style.transform&&e.firstChild.firstChild.lastChild.firstChild.firstChild.firstChild.firstChild.dispatchEvent(new MouseEvent("mousedown",{bubbles:!0}))}getMessageFromElement(e){if(null===e.querySelector("[data-pre-plain-text]"))return;const t=e.querySelector("[data-pre-plain-text]").getAttribute("data-pre-plain-text").match(/\] (.*):/)[1],r=e.querySelector("[data-pre-plain-text]").lastChild.children[getChat().lastChild.querySelector("[data-pre-plain-text]").lastChild.childElementCount-2].innerText,n=null===e.querySelector("[data-pre-plain-text]").firstChild.firstChild.firstChild.lastChild.firstChild?null:e.querySelector("[data-pre-plain-text]").firstChild.firstChild.firstChild.lastChild.firstChild.lastChild.innerText,a=Array.from(e.querySelector("[data-pre-plain-text]").querySelectorAll("[src^=data]")),s=e.querySelector("[data-pre-plain-text]").getAttribute("data-pre-plain-text").match(/\[(.*)\]/)[1];return new Message(t,new MessageContent(r,n,a),s)}}const getTextBox=()=>document.querySelector("#main > footer > div._3ee1T._1LkpH.copyable-area > div._3uMse > div > div._3FRCZ.copyable-text.selectable-text"),getSendButton=()=>document.querySelector("#main > footer > div._3ee1T._1LkpH.copyable-area > div:nth-child(3) > button"),getChat=()=>document.querySelector("#main > div._3h-WS > div > div > div.z_tTQ"),getChats=()=>document.querySelector("#pane-side > div:nth-child(1) > div > div");class Message{constructor(e,t,r){this.sender=e,this.content=t,this.timestamp=r}}class MessageContent{constructor(e,t,r){this.message=e,this.reaction=t,this.images=r}}const TokenType={IDENTIFIER:"identifier",ROUND_BRACE_OPEN:"(",ROUND_BRACE_CLOSE:")",STRING:"string",SEMICOLON:";",EOF:"eof",COLON:":",COMMA:",",UNKNOWN:"unknown",PLUS:"+",MINUS:"-",INTEGER:"integer",MULTIPLY:"*",DIVIDE:"/",ASSIGN:"=",FUNCTION:"function",BLOCK_OPEN:"{",BLOCK_CLOSE:"}",RETURN:"return",GETFUNC:"%",EXECUTE:"execute",IF:"if",EQUALS:"==",GREATER_THAN:">",LESS_THAN:"<",TRUE:"true",FALSE:"false",TIMES:"#",VAR:"var",ASYNC:"async"};class Token{constructor(e,t,r,n){this.type=e,this.value=t,this.line=r,this.column=n}}function isLetter(e){return/[A-Za-z]/.test(e)}function isDigit(e){return/\d/.test(e)}var lexerText="",lexerPos=0,lexerColumn=1,lexerLine=1,currentChar="";class Lexer{constructor(e){lexerPos=0,lexerColumn=1,lexerLine=1,currentChar=(lexerText=e).charAt(lexerPos)}advance(){"\n"==currentChar&&(lexerLine+=1,lexerColumn=0),lexerPos+=1,currentChar=lexerText.charAt(lexerPos),lexerColumn+=1}peekChar(){return lexerText.charAt(lexerPos+1)}getNextToken(){for(var e=void 0;/\s+/.test(currentChar);)this.advance();if(Object.keys(TokenType).forEach((function(t){var r=TokenType[t];if(1==r.length)currentChar==r&&(e=new Token(r,currentChar,lexerLine,lexerColumn));else if(2==r.length){var n=this.peekChar();currentChar==r.charAt(0)&&n==r.charAt(1)&&(e=new Token(r,currentChar+n,lexerLine,lexerColumn),this.advance())}}),this),void 0!==e)return this.advance(),e;if('"'==currentChar){this.advance();for(var t="",r=lexerLine,n=lexerColumn;'"'!==currentChar&&""!==currentChar;)t+=currentChar,this.advance();if(""==currentChar)throw new Error("Unterminated string");return this.advance(),new Token(TokenType.STRING,t,r,n)}if(isLetter(currentChar)||"_"==currentChar){var a="";for(r=lexerLine,n=lexerColumn;isLetter(currentChar)||"_"==currentChar||isDigit(currentChar);)a+=currentChar,this.advance();return"function"==a?new Token(TokenType.FUNCTION,a,r,n):"return"==a?new Token(TokenType.RETURN,a,r,n):"execute"==a?new Token(TokenType.EXECUTE,a,r,n):"if"==a?new Token(TokenType.IF,a,r,n):"true"==a?new Token(TokenType.TRUE,!0,r,n):"false"==a?new Token(TokenType.FALSE,!1,r,n):new Token("var"==a?TokenType.VAR:"async"==a?TokenType.ASYNC:TokenType.IDENTIFIER,a,r,n)}if(""==currentChar)return new Token(TokenType.EOF,"",lexerLine,lexerColumn);if(isDigit(currentChar)){var s="";for(r=lexerLine,n=lexerColumn;isDigit(currentChar);)s+=currentChar,this.advance();if(s.length>10)throw new Error("Max integer value is 2147483647");if(10==s.length&&s>2147483647)throw new Error("Max integer value is 2147483647");return new Token(TokenType.INTEGER,s,r,n)}throw new Error("Unknown character: '"+currentChar+"', at "+lexerLine+":"+lexerColumn)}peekToken(){var e=lexerPos,t=lexerLine,r=lexerColumn;this.advance();var n=this.getNextToken();return lexerPos=e,currentChar=lexerText.charAt(lexerPos),lexerColumn=r,lexerLine=t,n}}const NodeType={FUNCTION_CALL:"call",EXPRESSION:"expression",ASSIGNMENT:"assignment",FUNCTION_DECLARATION:"functionDeclaration",STATEMENT_LIST:"statementList",RETURN_STATEMENT:"returnStatement",EXECUTE_STATEMENT:"executeStatement",IF_STATEMENT:"ifStatement",NO_STATEMENT:"noStatement"},ExpressionType={BINARY_OPERATOR:"binaryOperator",UNARY_OPERATOR:"unaryOperator",NUMBER:"number",VARIABLE:"variable",STRING:"string",GETFUNC:"getfunc",DIRECT_BOOLEAN:"boolean"},OperatorType={PLUS:"+",MINUS:"-",MULTIPLY:"*",DIVIDE:"/",EQUALS:"==",GREATER_THAN:">",LESS_THAN:"<"};class LangFunction{constructor(e,t,r,n,a,s){this.parameters=e,this.block=t,this.native=r,this.async=n,this.ar=a,this.code=s}}LangFunction.prototype.toString=function(){return"f()"};class Node{constructor(e,t){this.type=e,this.data=t}visit(){if(this.type==NodeType.EXPRESSION){const a=(e,t)=>e.includes(typeof t),o=(e,t)=>{throw void 0===e&&(e="void"),new Error("Operator '"+t+"' does not support operand '"+e+"'")};if(this.data.type==ExpressionType.BINARY_OPERATOR){if(this.data.operator==OperatorType.PLUS){var e=this.data.operand1.visit(),t=this.data.operand2.visit();if(a(["string","number"],e)||o(e,this.data.operator),a(["string","number"],t)||o(t,this.data.operator),(i=e+t)>2147483647||i<-2147483647)throw new Error("Max integer value is 2147483647");return i}if(this.data.operator==OperatorType.MINUS){e=this.data.operand1.visit(),t=this.data.operand2.visit();if(a(["number"],e)||o(e,this.data.operator),a(["number"],t)||o(t,this.data.operator),(i=e-t)>2147483647||i<-2147483647)throw new Error("Max integer value is 2147483647");return i}if(this.data.operator==OperatorType.MULTIPLY){e=this.data.operand1.visit(),t=this.data.operand2.visit();if(a(["string","number"],e)||o(e,this.data.operator),a(["string","number"],t)||o(t,this.data.operator),"string"==typeof e&&"string"==typeof t)throw new Error("Can't multiply 2 strings, only numbers or a string and a number");if("string"==typeof e)return e.repeat(t);if("string"==typeof t)return t.repeat(e);if((i=e*t)>2147483647||i<-2147483647)throw new Error("Max integer value is 2147483647");return i}if(this.data.operator==OperatorType.DIVIDE){e=this.data.operand1.visit(),t=this.data.operand2.visit();if(a(["number"],e)||o(e,this.data.operator),a(["number"],t)||o(t,this.data.operator),(i=e/t)>2147483647||i<-2147483647)throw new Error("Max integer value is 2147483647");return i}if(this.data.operator==OperatorType.EQUALS)return(e=this.data.operand1.visit())==(t=this.data.operand2.visit());if(this.data.operator==OperatorType.GREATER_THAN){e=this.data.operand1.visit(),t=this.data.operand2.visit();return a(["number"],e)||o(e,this.data.operator),a(["number"],t)||o(t,this.data.operator),e>t}if(this.data.operator==OperatorType.LESS_THAN){e=this.data.operand1.visit(),t=this.data.operand2.visit();return a(["number"],e)||o(e,this.data.operator),a(["number"],t)||o(t,this.data.operator),e<t}}else if(this.data.type==ExpressionType.UNARY_OPERATOR){var r=this.data.operand1.visit();if(a(["number"],r)||o(r,this.data.operator),this.data.operator==OperatorType.PLUS)return+r;if(this.data.operator==OperatorType.MINUS)return-r}else{if(this.data.type==ExpressionType.NUMBER||this.data.type==ExpressionType.STRING||this.data.type==ExpressionType.DIRECT_BOOLEAN)return this.data.value;if(this.data.type==ExpressionType.VARIABLE){var n=(l=CallStack.getCurrentAR()).get(this.data.name);if(void 0!==n)return n;throw new Error("Variable '"+this.data.name+"' is not defined")}if(this.data.type==ExpressionType.GETFUNC){if(void 0===(s=CallStack.getCurrentAR().getFunction(this.data.name)))throw new Error("Function '"+this.data.name+"' is not defined");return s}}}else if(this.type==NodeType.ASSIGNMENT){if("_"==this.data.name.charAt(0))throw new Error("Can't create or change static variables (starting with '_')");CallStack.getCurrentAR().save(this.data.name,this.data.value.visit(),this.data.declare)}else if(this.type==NodeType.STATEMENT_LIST){if(CallStack.getCurrentAR().type==ARType.GLOBAL&&1==this.data.statements.length)return this.data.statements[0].visit();for(var a=0;a<this.data.statements.length&&(this.data.statements[a].visit(),void 0===CallStack.getReturnValue());a++);}else if(this.type==NodeType.FUNCTION_DECLARATION)CallStack.getCurrentAR().addFunction(this.data.name,new LangFunction(this.data.parameters,this.data.block,!1,this.data.async,CallStack.getCurrentAR(),null));else{if(this.type==NodeType.FUNCTION_CALL){var s,i;if(void 0===(s=(c=CallStack.getCurrentAR()).getFunction(this.data.name)))throw new Error("Function '"+this.data.name+"' is not defined");if(s.async)throw new Error("Async functions aren't supported yet");var o=this.data.times.visit();if("number"!=typeof o)throw new Error("Function execute number must be a number");for(var T=0;T<o;T++){var l=new ActivationRecord(this.data.name,ARType.FUNCTION,s.ar,c),p=s.parameters,u=this.data.parameters;for(a=0;a<p.length;a++){var h=p[a];if(void 0===u[h])throw new Error("Parameter not present in function call '"+this.data.name+"': '"+h+"'");l.save(h,u[h].visit(),!0)}CallStack.setCurrentAR(l),s.native?CallStack.setReturnValue(s.code(l)):s.block.visit(),i=CallStack.getReturnValue(),CallStack.setReturnValue(void 0),CallStack.setCurrentAR(c)}return i}if(this.type==NodeType.IF_STATEMENT){var c=CallStack.getCurrentAR();l=new ActivationRecord(null,ARType.IF_STATEMENT,c,c);CallStack.setCurrentAR(l);var d=this.data.expression.visit();if("boolean"!=typeof d)throw new Error("If expression is not a boolean");d&&this.data.block.visit(),CallStack.setCurrentAR(c)}else{if(this.type==NodeType.EXECUTE_STATEMENT)throw new Error("Execute statements aren't supported yet");this.type==NodeType.RETURN_STATEMENT&&CallStack.setReturnValue(this.data.value.visit())}}}}class Parser{constructor(e){this.lexer=new Lexer(e),this.currentToken=this.lexer.getNextToken()}eat(e){if(this.currentToken.type!=e)throw this.currentToken.type!==TokenType.EOF?new Error("Unexpected token: '"+this.currentToken.value+"', at "+this.currentToken.line+":"+this.currentToken.column):(console.log(e+" expected"),new Error("Unexpected line end"));this.currentToken=this.lexer.getNextToken()}formalParameterList(){var e=[];if(this.currentToken.type==TokenType.IDENTIFIER)for(e.push(this.currentToken.value),this.eat(TokenType.IDENTIFIER);this.currentToken.type==TokenType.COMMA;)this.eat(TokenType.COMMA),e.push(this.currentToken.value),this.eat(TokenType.IDENTIFIER);return e}actualParameter(){var e=this.currentToken.value;return this.eat(TokenType.IDENTIFIER),this.eat(TokenType.COLON),{name:e,value:this.expression()}}actualParameterList(){var e=[];if(this.currentToken.type==TokenType.IDENTIFIER){var t=this.actualParameter();for(e[t.name]=t.value;this.currentToken.type==TokenType.COMMA;)this.eat(TokenType.COMMA),e[(t=this.actualParameter()).name]=t.value}return e}functionCall(e){this.eat(TokenType.ROUND_BRACE_OPEN);var t=this.actualParameterList();this.eat(TokenType.ROUND_BRACE_CLOSE);var r=new Node(NodeType.EXPRESSION,{type:ExpressionType.NUMBER,value:1});return this.currentToken.type==TokenType.TIMES&&(this.eat(TokenType.TIMES),r=this.expression()),new Node(NodeType.FUNCTION_CALL,{name:e,parameters:t,times:r})}executeStatement(){this.eat(TokenType.EXECUTE);var e=this.expression();this.eat(TokenType.COMMA),this.eat(TokenType.ROUND_BRACE_OPEN);var t=this.actualParameterList();return this.eat(TokenType.ROUND_BRACE_CLOSE),new Node(NodeType.EXECUTE_STATEMENT,{func:e,parameters:t})}getFunc(){this.eat(TokenType.GETFUNC);var e=this.currentToken.value;return this.eat(TokenType.IDENTIFIER),new Node(NodeType.EXPRESSION,{type:ExpressionType.GETFUNC,name:e})}functionDeclaration(){var e=!1;this.currentToken.type==TokenType.ASYNC&&(this.eat(TokenType.ASYNC),e=!0),this.eat(TokenType.FUNCTION);var t=this.currentToken.value;this.eat(TokenType.IDENTIFIER),this.eat(TokenType.ROUND_BRACE_OPEN);var r=this.formalParameterList();this.eat(TokenType.ROUND_BRACE_CLOSE);var n=this.block();return new Node(NodeType.FUNCTION_DECLARATION,{name:t,parameters:r,block:n,async:e})}factor(){if(this.currentToken.type==TokenType.INTEGER){var e=this.currentToken.value;return this.eat(TokenType.INTEGER),new Node(NodeType.EXPRESSION,{type:ExpressionType.NUMBER,value:Number.parseInt(e)})}if(this.currentToken.type==TokenType.STRING){e=this.currentToken.value;return this.eat(TokenType.STRING),new Node(NodeType.EXPRESSION,{type:ExpressionType.STRING,value:e})}if(this.currentToken.type==TokenType.ROUND_BRACE_OPEN){this.eat(TokenType.ROUND_BRACE_OPEN);var t=this.expression();return this.eat(TokenType.ROUND_BRACE_CLOSE),t}if(this.currentToken.type==TokenType.PLUS)return this.eat(TokenType.PLUS),new Node(NodeType.EXPRESSION,{type:ExpressionType.UNARY_OPERATOR,operand1:this.factor(),operator:OperatorType.PLUS});if(this.currentToken.type==TokenType.MINUS)return this.eat(TokenType.MINUS),new Node(NodeType.EXPRESSION,{type:ExpressionType.UNARY_OPERATOR,operand1:this.factor(),operator:OperatorType.MINUS});if(this.currentToken.type==TokenType.GETFUNC)return this.getFunc();if(this.currentToken.type==TokenType.EXECUTE)return this.executeStatement();if(this.currentToken.type==TokenType.IDENTIFIER){console.log("factor identifier");var r=this.currentToken.value;return this.eat(TokenType.IDENTIFIER),this.currentToken.type==TokenType.ROUND_BRACE_OPEN?this.functionCall(r):new Node(NodeType.EXPRESSION,{type:ExpressionType.VARIABLE,name:r})}return new Node(NodeType.NO_STATEMENT,{})}term(){for(var e=this.factor();this.currentToken.type==TokenType.MULTIPLY||this.currentToken.type==TokenType.DIVIDE;)this.currentToken.type==TokenType.MULTIPLY?(this.eat(TokenType.MULTIPLY),e=new Node(NodeType.EXPRESSION,{type:ExpressionType.BINARY_OPERATOR,operand1:e,operand2:this.factor(),operator:OperatorType.MULTIPLY})):(this.eat(TokenType.DIVIDE),e=new Node(NodeType.EXPRESSION,{type:ExpressionType.BINARY_OPERATOR,operand1:e,operand2:this.factor(),operator:OperatorType.DIVIDE}));return e}booleanExpression(){var e=this.currentToken.value;return this.currentToken.type==TokenType.TRUE?this.eat(TokenType.TRUE):this.eat(TokenType.FALSE),new Node(NodeType.EXPRESSION,{type:ExpressionType.DIRECT_BOOLEAN,value:e})}booleanExpressionWithFirst(e){if(this.currentToken.type==TokenType.EQUALS){this.eat(TokenType.EQUALS);var t=this.expression();return new Node(NodeType.EXPRESSION,{type:ExpressionType.BINARY_OPERATOR,operand1:e,operand2:t,operator:OperatorType.EQUALS})}if(this.currentToken.type==TokenType.GREATER_THAN){this.eat(TokenType.GREATER_THAN);t=this.expression();return new Node(NodeType.EXPRESSION,{type:ExpressionType.BINARY_OPERATOR,operand1:e,operand2:t,operator:OperatorType.GREATER_THAN})}this.eat(TokenType.LESS_THAN);t=this.expression();return new Node(NodeType.EXPRESSION,{type:ExpressionType.BINARY_OPERATOR,operand1:e,operand2:t,operator:OperatorType.LESS_THAN})}expression(){if(this.currentToken.type==TokenType.TRUE||this.currentToken.type==TokenType.FALSE)return this.booleanExpression();for(var e=this.term();this.currentToken.type==TokenType.PLUS||this.currentToken.type==TokenType.MINUS;)this.currentToken.type==TokenType.PLUS?(this.eat(TokenType.PLUS),e=new Node(NodeType.EXPRESSION,{type:ExpressionType.BINARY_OPERATOR,operand1:e,operand2:this.term(),operator:OperatorType.PLUS})):(this.eat(TokenType.MINUS),e=new Node(NodeType.EXPRESSION,{type:ExpressionType.BINARY_OPERATOR,operand1:e,operand2:this.term(),operator:OperatorType.MINUS}));return this.currentToken.type==TokenType.EQUALS||this.currentToken.type==TokenType.GREATER_THAN||this.currentToken.type==TokenType.LESS_THAN?this.booleanExpressionWithFirst(e):e}assignment(){var e=!1;this.currentToken.type==TokenType.VAR&&(e=!0,this.eat(TokenType.VAR));var t=this.currentToken.value;this.eat(TokenType.IDENTIFIER),this.eat(TokenType.ASSIGN);var r=this.expression();return new Node(NodeType.ASSIGNMENT,{name:t,value:r,declare:e})}statement(){return console.log,this.lexer.peekToken().type==TokenType.ASSIGN||this.currentToken.type==TokenType.VAR?this.assignment():this.currentToken.type==TokenType.FUNCTION||this.currentToken.type==TokenType.ASYNC?this.functionDeclaration():this.currentToken.type==TokenType.RETURN?this.returnStatement():this.currentToken.type==TokenType.IF?this.ifStatement():this.expression()}block(){this.eat(TokenType.BLOCK_OPEN);var e=new Node(NodeType.STATEMENT_LIST,{statements:[]});return this.currentToken.type!==TokenType.BLOCK_CLOSE&&(e=this.statementList()),this.eat(TokenType.BLOCK_CLOSE),e}returnStatement(){this.eat(TokenType.RETURN);var e=this.expression();return new Node(NodeType.RETURN_STATEMENT,{value:e})}ifStatement(){this.eat(TokenType.IF);var e=this.expression(),t=this.block();return new Node(NodeType.IF_STATEMENT,{expression:e,block:t})}statementList(){var e=[];for(e.push(this.statement());this.currentToken.type==TokenType.SEMICOLON;)this.eat(TokenType.SEMICOLON),e.push(this.statement());return console.log(this.currentToken.type+" hoi"),new Node(NodeType.STATEMENT_LIST,{statements:e})}parse(){var e=this.statementList();return this.eat(TokenType.EOF),e}}class WaLang{static setup(){var e=new ActivationRecord("_GLOBAL",ARType.GLOBAL,null,null);e.save("_COOLNESSLEVEL","Very Cool",!0),e.save("_HELP","-------* Help Menu *-------\nNothing here, yet!",!0),e.addFunction("print",new LangFunction(["message"],null,!0,!1,e,(function(e){Console.log(e.get("message"))}))),e.addFunction("random",new LangFunction([],null,!0,!1,e,(function(e){return Math.random()}))),e.addFunction("hours",new LangFunction([],null,!0,!1,e,(function(e){return(new Date).getHours()}))),e.addFunction("minutes",new LangFunction([],null,!0,!1,e,(function(e){return(new Date).getMinutes()}))),e.addFunction("seconds",new LangFunction([],null,!0,!1,e,(function(e){return(new Date).getSeconds()}))),e.addFunction("millis",new LangFunction([],null,!0,!1,e,(function(e){return(new Date).getMilliseconds()}))),CallStack.setCurrentAR(e)}}var currentAR,returnValue,programRunning=!1;class Console{static log(e){client.sendMessage(e)}static error(e){client.sendMessage("*Error: "+e+"*")}static logRed(e){client.sendMessage("*"+e+"*")}static programStarted(e){client.sendMessage("Starting program _"+e+"_..."),programRunning=!0}static programEnded(){client.sendMessage("Program finished."),programRunning=!1}}class CallStack{static setCurrentAR(e){currentAR=e}static getCurrentAR(){return currentAR}static clear(){for(;currentAR.type!==ARType.GLOBAL;)currentAR=currentAR.caller}static asString(){return"Call Stack (most recent call first):\n"+currentAR.asString()}static setReturnValue(e){returnValue=e}static getReturnValue(){return returnValue}}const ARType={GLOBAL:"g",PROGRAM:"program",FUNCTION:"f()",ANONYMOUS_FUNCTION:"anonymous f()",IF_STATEMENT:"if"};class ActivationRecord{constructor(e,t,r,n){if(this.functions={},this.name=e,this.type=t,this.underlyingAR=r,this.caller=n,this.level=null!==r?r.level+1:0,null!==n){if(this.callLevel=n.callLevel+1,this.callLevel>2e3)throw new Error("Max stack size exceeded (2000)")}else this.callLevel=0;this.vars={_CONTEXT:this.asString()}}forceSave(e,t){this.vars[e]=t}save(e,t,r){if(r){if(void 0!==this.getLocal(e))throw new Error("Variable '"+e+"' is already declared");this.vars[e]=t}else if(void 0===this.getLocal(e)){if(null===this.underlyingAR)throw new Error("Variable '"+e+"' is not declared");this.underlyingAR.save(e,t,!1)}else this.vars[e]=t}addFunction(e,t){this.functions[e]=t}getLocal(e){return this.vars[e]}get(e){var t=this.vars[e];return void 0===t&&this.level>0&&(t=this.underlyingAR.get(e)),t}getFunction(e){var t=this.functions[e];return void 0===t&&this.level>0&&(t=this.underlyingAR.getFunction(e)),t}asString(){return"    "+this.callLevel+": "+this.type+(null==this.name?"":" "+this.name)+(null==this.caller?"":"\n"+this.caller.asString())}}class Interpreter{static execute(e){try{var t=new Parser(e).parse()}catch(e){return Console.error(e.message),void console.error(e)}try{var r=t.visit();void 0!==r&&Console.log(r)}catch(e){Console.error(e.message),console.error(e),Console.logRed(CallStack.asString())}CallStack.clear()}static executeProgram(e,t){Console.programStarted(t);try{var r=new Parser(e).parse()}catch(e){return Console.error(e.message),void console.error(e)}try{var n=new ActivationRecord(t,ARType.PROGRAM,CallStack.getCurrentAR(),CallStack.getCurrentAR());CallStack.setCurrentAR(n),r.visit()}catch(e){Console.error(e.message),console.error(e),Console.logRed(CallStack.asString())}CallStack.clear(),Console.programEnded()}}const client=new Client({queue:!0});var programs=new Map;WaLang.setup(),client.on("message",e=>{try{var t=e.content.message.split("\n"),r=t[0];t.shift();var n=t.join("\n"),a=r.split(" ");if("!define"==a[0]&&2==a.length){var s=a[1];programs.set(s,n)}}catch(e){console.log(e)}}),client.registerCommand("run",(e,t)=>{var r=t[0],n=programs.get(r);null==n?client.sendMessage("That program does not exist."):Interpreter.executeProgram(n,r)});