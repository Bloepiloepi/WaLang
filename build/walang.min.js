var client=function(){const t=()=>document.querySelector("#main > footer > div._3ee1T._1LkpH.copyable-area > div._3uMse > div > div._3FRCZ.copyable-text.selectable-text"),e=()=>document.querySelector("#main > footer > div._3ee1T._1LkpH.copyable-area > div:nth-child(3) > button"),r=()=>document.querySelector("#main > div._3h-WS > div > div > div.z_tTQ"),a=()=>document.querySelector("#pane-side > div:nth-child(1) > div > div");class n{constructor(t,e,r){this.sender=t,this.content=e,this.timestamp=r}}class s{constructor(t,e,r){this.message=t,this.reaction=e,this.images=r}}const i={IDENTIFIER:"identifier",ROUND_BRACE_OPEN:"(",ROUND_BRACE_CLOSE:")",STRING:"string",SEMICOLON:";",EOF:"eof",COLON:":",COMMA:",",UNKNOWN:"unknown",PLUS:"+",MINUS:"-",INTEGER:"integer",MULTIPLY:"*",DIVIDE:"/",ASSIGN:"=",FUNCTION:"function",BLOCK_OPEN:"{",BLOCK_CLOSE:"}",RETURN:"return",GETFUNC:"%",EXECUTE:"execute",IF:"if",EQUALS:"==",GREATER_THAN:">",LESS_THAN:"<",TRUE:"true",FALSE:"false",TIMES:"#",VAR:"var",ASYNC:"async"};class o{constructor(t,e,r,a){this.type=t,this.value=e,this.line=r,this.column=a}}function h(t){return/[A-Za-z]/.test(t)}function u(t){return/\d/.test(t)}var l="",c=0,d=1,p=1,v="";class f{constructor(t){c=0,d=1,p=1,v=(l=t).charAt(c)}advance(){"\n"==v&&(p+=1,d=0),c+=1,v=l.charAt(c),d+=1}peekChar(){return l.charAt(c+1)}getNextToken(){for(var t=void 0;/\s+/.test(v);)this.advance();if(Object.keys(i).forEach((function(e){var r=i[e];if(1==r.length)v==r&&(t=new o(r,v,p,d));else if(2==r.length){var a=this.peekChar();v==r.charAt(0)&&a==r.charAt(1)&&(t=new o(r,v+a,p,d),this.advance())}}),this),void 0!==t)return this.advance(),t;if('"'==v){this.advance();for(var e="",r=p,a=d;'"'!==v&&""!==v;)e+=v,this.advance();if(""==v)throw new Error("Unterminated string");return this.advance(),new o(i.STRING,e,r,a)}if(h(v)||"_"==v){var n="";for(r=p,a=d;h(v)||"_"==v||u(v);)n+=v,this.advance();return"function"==n?new o(i.FUNCTION,n,r,a):"return"==n?new o(i.RETURN,n,r,a):"execute"==n?new o(i.EXECUTE,n,r,a):"if"==n?new o(i.IF,n,r,a):"true"==n?new o(i.TRUE,!0,r,a):"false"==n?new o(i.FALSE,!1,r,a):new o("var"==n?i.VAR:"async"==n?i.ASYNC:i.IDENTIFIER,n,r,a)}if(""==v)return new o(i.EOF,"",p,d);if(u(v)){var s="";for(r=p,a=d;u(v);)s+=v,this.advance();if(s.length>10)throw new Error("Max integer value is 2147483647");if(10==s.length&&s>2147483647)throw new Error("Max integer value is 2147483647");return new o(i.INTEGER,s,r,a)}throw new Error("Unknown character: '"+v+"', at "+p+":"+d)}peekToken(){var t=c,e=p,r=d;this.advance();var a=this.getNextToken();return c=t,v=l.charAt(c),d=r,p=e,a}}const m="call",E="expression",g="assignment",y="functionDeclaration",T="statementList",w="returnStatement",C="executeStatement",R="ifStatement",A="noStatement",N="binaryOperator",S="unaryOperator",I="number",O="variable",k="string",L="getfunc",x="boolean",b="+",_="-",M="*",U="/",F="==",D=">",P="<";class G{constructor(t,e,r,a,n,s){this.parameters=t,this.block=e,this.native=r,this.async=a,this.ar=n,this.code=s}}G.prototype.toString=function(){return"f()"};class V{constructor(t,e){this.type=t,this.data=e}visit(){if(this.type==E){const n=(t,e)=>t.includes(typeof e),s=(t,e)=>{throw void 0===t&&(t="void"),new Error("Operator '"+e+"' does not support operand '"+t+"'")};if(this.data.type==N){if(this.data.operator==b){var t=this.data.operand1.visit(),e=this.data.operand2.visit();if(n(["string","number"],t)||s(t,this.data.operator),n(["string","number"],e)||s(e,this.data.operator),(v=t+e)>2147483647||v<-2147483647)throw new Error("Max integer value is 2147483647");return v}if(this.data.operator==_){t=this.data.operand1.visit(),e=this.data.operand2.visit();if(n(["number"],t)||s(t,this.data.operator),n(["number"],e)||s(e,this.data.operator),(v=t-e)>2147483647||v<-2147483647)throw new Error("Max integer value is 2147483647");return v}if(this.data.operator==M){t=this.data.operand1.visit(),e=this.data.operand2.visit();if(n(["string","number"],t)||s(t,this.data.operator),n(["string","number"],e)||s(e,this.data.operator),"string"==typeof t&&"string"==typeof e)throw new Error("Can't multiply 2 strings, only numbers or a string and a number");if("string"==typeof t)return t.repeat(e);if("string"==typeof e)return e.repeat(t);if((v=t*e)>2147483647||v<-2147483647)throw new Error("Max integer value is 2147483647");return v}if(this.data.operator==U){t=this.data.operand1.visit(),e=this.data.operand2.visit();if(n(["number"],t)||s(t,this.data.operator),n(["number"],e)||s(e,this.data.operator),(v=t/e)>2147483647||v<-2147483647)throw new Error("Max integer value is 2147483647");return v}if(this.data.operator==F)return(t=this.data.operand1.visit())==(e=this.data.operand2.visit());if(this.data.operator==D){t=this.data.operand1.visit(),e=this.data.operand2.visit();return n(["number"],t)||s(t,this.data.operator),n(["number"],e)||s(e,this.data.operator),t>e}if(this.data.operator==P){t=this.data.operand1.visit(),e=this.data.operand2.visit();return n(["number"],t)||s(t,this.data.operator),n(["number"],e)||s(e,this.data.operator),t<e}}else if(this.data.type==S){var r=this.data.operand1.visit();if(n(["number"],r)||s(r,this.data.operator),this.data.operator==b)return+r;if(this.data.operator==_)return-r}else{if(this.data.type==I||this.data.type==k||this.data.type==x)return this.data.value;if(this.data.type==O){var a=(o=W.getCurrentAR()).get(this.data.name);if(void 0!==a)return a;throw new Error("Variable '"+this.data.name+"' is not defined")}if(this.data.type==L){if(void 0===(d=W.getCurrentAR().getFunction(this.data.name)))throw new Error("Function '"+this.data.name+"' is not defined");return d}}}else if(this.type==g){if("_"==this.data.name.charAt(0))throw new Error("Can't create or change static variables (starting with '_')");W.getCurrentAR().save(this.data.name,this.data.value.visit(),this.data.declare)}else if(this.type==T){if(W.getCurrentAR().type==K.GLOBAL&&1==this.data.statements.length)return this.data.statements[0].visit();for(var n=0;n<this.data.statements.length&&(this.data.statements[n].visit(),void 0===W.getReturnValue());n++);}else if(this.type==y)W.getCurrentAR().addFunction(this.data.name,new G(this.data.parameters,this.data.block,!1,this.data.async,W.getCurrentAR(),null));else{if(this.type==m){if(void 0===(d=(l=W.getCurrentAR()).getFunction(this.data.name)))throw new Error("Function '"+this.data.name+"' is not defined");if(d.async)throw new Error("Async functions aren't supported yet");var s=this.data.times.visit();if("number"!=typeof s)throw new Error("Function execute number must be a number");for(var i=0;i<s;i++){var o=new Q(this.data.name,K.FUNCTION,d.ar,l),h=d.parameters,u=this.data.parameters;for(n=0;n<h.length;n++){if(void 0===u[p=h[n]])throw new Error("Parameter not present in function call '"+this.data.name+"': '"+p+"'");o.save(p,u[p].visit(),!0)}W.setCurrentAR(o),d.native?W.setReturnValue(d.code(o)):d.block.visit(),v=W.getReturnValue(),W.setReturnValue(void 0),W.setCurrentAR(l)}return v}if(this.type==R){var l=W.getCurrentAR();o=new Q(null,K.IF_STATEMENT,l,l);W.setCurrentAR(o);var c=this.data.expression.visit();if("boolean"!=typeof c)throw new Error("If expression is not a boolean");c&&this.data.block.visit(),W.setCurrentAR(l)}else{if(this.type==C){var d;l=W.getCurrentAR();if(!((d=this.data.func.visit())instanceof G))throw new Error("Execute argument is not a function");if(d.async)throw new Error("Async functions aren't supported yet");for(o=new Q(null,K.ANONYMOUS_FUNCTION,d.ar,l),h=d.parameters,u=this.data.parameters,n=0;n<h.length;n++){var p;if(void 0===u[p=h[n]])throw new Error("Parameter not present in function call '"+this.data.name+"': '"+p+"'");o.save(p,u[p].visit(),!0)}W.setCurrentAR(o),d.native?W.setReturnValue(d.code(o)):d.block.visit();var v=W.getReturnValue();return W.setReturnValue(void 0),W.setCurrentAR(l),v}this.type==w&&W.setReturnValue(this.data.value.visit())}}}}class B{constructor(t){this.lexer=new f(t),this.currentToken=this.lexer.getNextToken()}eat(t){if(this.currentToken.type!=t)throw this.currentToken.type!==i.EOF?new Error("Unexpected token: '"+this.currentToken.value+"', at "+this.currentToken.line+":"+this.currentToken.column):(console.log(t+" expected"),new Error("Unexpected line end"));this.currentToken=this.lexer.getNextToken()}formalParameterList(){var t=[];if(this.currentToken.type==i.IDENTIFIER)for(t.push(this.currentToken.value),this.eat(i.IDENTIFIER);this.currentToken.type==i.COMMA;)this.eat(i.COMMA),t.push(this.currentToken.value),this.eat(i.IDENTIFIER);return t}actualParameter(){var t=this.currentToken.value;return this.eat(i.IDENTIFIER),this.eat(i.COLON),{name:t,value:this.expression()}}actualParameterList(){var t=[];if(this.currentToken.type==i.IDENTIFIER){var e=this.actualParameter();for(t[e.name]=e.value;this.currentToken.type==i.COMMA;)this.eat(i.COMMA),t[(e=this.actualParameter()).name]=e.value}return t}functionCall(t){this.eat(i.ROUND_BRACE_OPEN);var e=this.actualParameterList();this.eat(i.ROUND_BRACE_CLOSE);var r=new V(E,{type:I,value:1});return this.currentToken.type==i.TIMES&&(this.eat(i.TIMES),r=this.expression()),new V(m,{name:t,parameters:e,times:r})}executeStatement(){this.eat(i.EXECUTE);var t=this.expression();this.eat(i.COMMA),this.eat(i.ROUND_BRACE_OPEN);var e=this.actualParameterList();return this.eat(i.ROUND_BRACE_CLOSE),new V(C,{func:t,parameters:e})}getFunc(){this.eat(i.GETFUNC);var t=this.currentToken.value;return this.eat(i.IDENTIFIER),new V(E,{type:L,name:t})}functionDeclaration(){var t=!1;this.currentToken.type==i.ASYNC&&(this.eat(i.ASYNC),t=!0),this.eat(i.FUNCTION);var e=this.currentToken.value;this.eat(i.IDENTIFIER),this.eat(i.ROUND_BRACE_OPEN);var r=this.formalParameterList();this.eat(i.ROUND_BRACE_CLOSE);var a=this.block();return new V(y,{name:e,parameters:r,block:a,async:t})}factor(){if(this.currentToken.type==i.INTEGER){var t=this.currentToken.value;return this.eat(i.INTEGER),new V(E,{type:I,value:Number.parseInt(t)})}if(this.currentToken.type==i.STRING){t=this.currentToken.value;return this.eat(i.STRING),new V(E,{type:k,value:t})}if(this.currentToken.type==i.ROUND_BRACE_OPEN){this.eat(i.ROUND_BRACE_OPEN);var e=this.expression();return this.eat(i.ROUND_BRACE_CLOSE),e}if(this.currentToken.type==i.PLUS)return this.eat(i.PLUS),new V(E,{type:S,operand1:this.factor(),operator:b});if(this.currentToken.type==i.MINUS)return this.eat(i.MINUS),new V(E,{type:S,operand1:this.factor(),operator:_});if(this.currentToken.type==i.GETFUNC)return this.getFunc();if(this.currentToken.type==i.EXECUTE)return this.executeStatement();if(this.currentToken.type==i.IDENTIFIER){var r=this.currentToken.value;return this.eat(i.IDENTIFIER),this.currentToken.type==i.ROUND_BRACE_OPEN?this.functionCall(r):new V(E,{type:O,name:r})}return new V(A,{})}term(){for(var t=this.factor();this.currentToken.type==i.MULTIPLY||this.currentToken.type==i.DIVIDE;)this.currentToken.type==i.MULTIPLY?(this.eat(i.MULTIPLY),t=new V(E,{type:N,operand1:t,operand2:this.factor(),operator:M})):(this.eat(i.DIVIDE),t=new V(E,{type:N,operand1:t,operand2:this.factor(),operator:U}));return t}booleanExpression(){var t=this.currentToken.value;return this.currentToken.type==i.TRUE?this.eat(i.TRUE):this.eat(i.FALSE),new V(E,{type:x,value:t})}booleanExpressionWithFirst(t){if(this.currentToken.type==i.EQUALS){this.eat(i.EQUALS);var e=this.expression();return new V(E,{type:N,operand1:t,operand2:e,operator:F})}if(this.currentToken.type==i.GREATER_THAN){this.eat(i.GREATER_THAN);e=this.expression();return new V(E,{type:N,operand1:t,operand2:e,operator:D})}this.eat(i.LESS_THAN);e=this.expression();return new V(E,{type:N,operand1:t,operand2:e,operator:P})}expression(){if(this.currentToken.type==i.TRUE||this.currentToken.type==i.FALSE)return this.booleanExpression();for(var t=this.term();this.currentToken.type==i.PLUS||this.currentToken.type==i.MINUS;)this.currentToken.type==i.PLUS?(this.eat(i.PLUS),t=new V(E,{type:N,operand1:t,operand2:this.term(),operator:b})):(this.eat(i.MINUS),t=new V(E,{type:N,operand1:t,operand2:this.term(),operator:_}));return this.currentToken.type==i.EQUALS||this.currentToken.type==i.GREATER_THAN||this.currentToken.type==i.LESS_THAN?this.booleanExpressionWithFirst(t):t}assignment(){var t=!1;this.currentToken.type==i.VAR&&(t=!0,this.eat(i.VAR));var e=this.currentToken.value;this.eat(i.IDENTIFIER),this.eat(i.ASSIGN);var r=this.expression();return new V(g,{name:e,value:r,declare:t})}statement(){return console.log,this.lexer.peekToken().type==i.ASSIGN||this.currentToken.type==i.VAR?this.assignment():this.currentToken.type==i.FUNCTION||this.currentToken.type==i.ASYNC?this.functionDeclaration():this.currentToken.type==i.RETURN?this.returnStatement():this.currentToken.type==i.IF?this.ifStatement():this.expression()}block(){this.eat(i.BLOCK_OPEN);var t=new V(T,{statements:[]});return this.currentToken.type!==i.BLOCK_CLOSE&&(t=this.statementList()),this.eat(i.BLOCK_CLOSE),t}returnStatement(){this.eat(i.RETURN);var t=this.expression();return new V(w,{value:t})}ifStatement(){this.eat(i.IF);var t=this.expression(),e=this.block();return new V(R,{expression:t,block:e})}statementList(){var t=[];for(t.push(this.statement());this.currentToken.type==i.SEMICOLON;)this.eat(i.SEMICOLON),t.push(this.statement());return new V(T,{statements:t})}parse(){var t=this.statementList();return this.eat(i.EOF),t}}var q,H;class Y{static log(t){X.sendMessage(t)}static error(t){X.sendMessage("*Error: "+t+"*")}static logRed(t){X.sendMessage("*"+t+"*")}static programStarted(t){X.sendMessage("Starting program _"+t+"_..."),!0}static programEnded(){X.sendMessage("Program finished."),!1}}class W{static setCurrentAR(t){q=t}static getCurrentAR(){return q}static clear(){for(;q.type!==K.GLOBAL;)q=q.caller}static asString(){return"Call Stack (most recent call first):\n"+q.asString()}static setReturnValue(t){H=t}static getReturnValue(){return H}}const K={GLOBAL:"g",PROGRAM:"program",FUNCTION:"f()",ANONYMOUS_FUNCTION:"anonymous f()",IF_STATEMENT:"if"};class Q{constructor(t,e,r,a){if(this.functions={},this.name=t,this.type=e,this.underlyingAR=r,this.caller=a,this.level=null!==r?r.level+1:0,null!==a){if(this.callLevel=a.callLevel+1,this.callLevel>2e3)throw new Error("Max stack size exceeded (2000)")}else this.callLevel=0;this.vars={_CONTEXT:this.asString()}}forceSave(t,e){this.vars[t]=e}save(t,e,r){if(r){if(void 0!==this.getLocal(t))throw new Error("Variable '"+t+"' is already declared");this.vars[t]=e}else if(void 0===this.getLocal(t)){if(null===this.underlyingAR)throw new Error("Variable '"+t+"' is not declared");this.underlyingAR.save(t,e,!1)}else this.vars[t]=e}addFunction(t,e){this.functions[t]=e}getLocal(t){return this.vars[t]}get(t){var e=this.vars[t];return void 0===e&&this.level>0&&(e=this.underlyingAR.get(t)),e}getFunction(t){var e=this.functions[t];return void 0===e&&this.level>0&&(e=this.underlyingAR.getFunction(t)),e}asString(){return"    "+this.callLevel+": "+this.type+(null==this.name?"":" "+this.name)+(null==this.caller?"":"\n"+this.caller.asString())}}const X=new class{constructor({prefix:t="!",self_commands:e=!0,queue:a=!1,queue_max_length:n=5,fetchInterval:s=100,autosaveInterval:i=1e4}={prefix:"!",self_commands:!0,queue:!1,queue_max_length:5,fetchInterval:100,autosaveInterval:1e4}){this.commands=new Map,this.events={},this.handledMessages=null===localStorage.getItem("handledMessages")?new Array:Array.from(JSON.parse(localStorage.getItem("handledMessages"))),this.messageFetcher=setInterval(()=>{if(null!==r()){const s=a?[].slice.call(r().children,-n):[r().lastChild];for(const r of s)if(r.hasAttribute("data-id")&&!this.handledMessages.includes(r.getAttribute("data-id"))){this.handledMessages.push(r.getAttribute("data-id"));const a=this.getMessageFromElement(r);if(void 0!==a){if(e||r.getAttribute("data-id").startsWith("false_"))for(const[e,r]of this.commands.entries())if(a.content.message.startsWith(t+e))return r(a,a.content.message.substring(t.length+e.length).split(" ").splice(1)),void this.emit("command",[e,r]);this.emit("message",a),this.emit("message_"+(r.getAttribute("data-id").startsWith("true_")?"self":"other"),a)}}}},s),this.autoSaver=setInterval(()=>{localStorage.setItem("handledMessages",JSON.stringify(null===localStorage.getItem("handledMessages")?new Array:Array.from(JSON.parse(localStorage.getItem("handledMessages"))).slice(-10*n)))},i),this.emit("init")}registerCommand(t,e){this.commands.set(t,e)}unregisterCommand(t){this.commands.delete(t)}emit(t,...e){for(let r of this.events[t]||[])r(...e)}on(t,e){return(this.events[t]=this.events[t]||[]).push(e),()=>this.events[t]=this.events[t].filter(t=>t!==e)}sendMessage(r){const a=t().textContent;t().textContent=r,t().dispatchEvent(new InputEvent("input",{bubbles:!0})),new Promise(r=>{null!==e()&&(e().click(),t().textContent=a,t().dispatchEvent(new InputEvent("input",{bubbles:!0})),r())})}gotoNewestChat(){for(const t of a().children)"translateY(0px)"===t.style.transform&&t.firstChild.firstChild.lastChild.firstChild.firstChild.firstChild.firstChild.dispatchEvent(new MouseEvent("mousedown",{bubbles:!0}))}getMessageFromElement(t){if(null===t.querySelector("[data-pre-plain-text]"))return;const e=t.querySelector("[data-pre-plain-text]").getAttribute("data-pre-plain-text").match(/\] (.*):/)[1],a=t.querySelector("[data-pre-plain-text]").lastChild.children[r().lastChild.querySelector("[data-pre-plain-text]").lastChild.childElementCount-2].innerText,i=null===t.querySelector("[data-pre-plain-text]").firstChild.firstChild.firstChild.lastChild.firstChild?null:t.querySelector("[data-pre-plain-text]").firstChild.firstChild.firstChild.lastChild.firstChild.lastChild.innerText,o=Array.from(t.querySelector("[data-pre-plain-text]").querySelectorAll("[src^=data]")),h=t.querySelector("[data-pre-plain-text]").getAttribute("data-pre-plain-text").match(/\[(.*)\]/)[1];return new n(e,new s(a,i,o),h)}stop(){clearInterval(this.messageFetcher),clearInterval(this.autoSaver)}}({queue:!0});var z=new Map;return class{static setup(){var t=new Q("_GLOBAL",K.GLOBAL,null,null);t.save("_COOLNESSLEVEL","Very Cool",!0),t.save("_HELP","-------* Help Menu *-------\nNothing here, yet!",!0),t.addFunction("print",new G(["message"],null,!0,!1,t,(function(t){Y.log(t.get("message"))}))),t.addFunction("random",new G([],null,!0,!1,t,(function(t){return Math.random()}))),t.addFunction("hours",new G([],null,!0,!1,t,(function(t){return(new Date).getHours()}))),t.addFunction("minutes",new G([],null,!0,!1,t,(function(t){return(new Date).getMinutes()}))),t.addFunction("seconds",new G([],null,!0,!1,t,(function(t){return(new Date).getSeconds()}))),t.addFunction("millis",new G([],null,!0,!1,t,(function(t){return(new Date).getMilliseconds()}))),W.setCurrentAR(t)}}.setup(),X.on("message",t=>{try{var e=t.content.message.split("\n"),r=e[0];e.shift();var a=e.join("\n"),n=r.split(" ");if("!define"==n[0]&&2==n.length){var s=n[1];z.set(s,a)}}catch(t){console.log(t)}}),X.registerCommand("run",(t,e)=>{var r=e[0],a=z.get(r);null==a?X.sendMessage("That program does not exist."):class{static execute(t){try{var e=new B(t).parse()}catch(t){return Y.error(t.message),void console.error(t)}try{var r=e.visit();void 0!==r&&Y.log(r)}catch(t){Y.error(t.message),console.error(t),Y.logRed(W.asString())}W.clear()}static executeProgram(t,e){Y.programStarted(e);try{var r=new B(t).parse()}catch(t){return Y.error(t.message),void console.error(t)}try{var a=new Q(e,K.PROGRAM,W.getCurrentAR(),W.getCurrentAR());W.setCurrentAR(a),r.visit()}catch(t){Y.error(t.message),console.error(t),Y.logRed(W.asString())}W.clear(),Y.programEnded()}}.executeProgram(a,r)}),X}();